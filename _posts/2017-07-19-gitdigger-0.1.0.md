---
title: GitDigger 0.1.0 开发日志
---

## 2017-07-24
每为仓库添加一个接口都要写重复的代码，例如：

``` python
@repos.route('/<string:username>/<string:name>/settings', methods=['GET'])
def settings(username, name):
    repo = get_repo(username, name)
    if repo is None:
        return abort(404)
    return render_template('repositories/settings/index.html', repo=repo)

@repos.route('/<string:username>/<string:name>', methods=['GET'])
def show(username, name):
    repo = get_repo(username, name)
    if repo is None:
        return abort(404)
    return render_template('repositories/show.html', repo=repo)
```

感觉好麻烦，要是能写个装饰器简化操作就好了。

``` python

@repo_route('/settings', methods=['GET'])
def settings(repo):
    pass

@repo_route('/', methods=['GET'])
def show(repo):
    pass
```

如何设置 Flask 的蓝图（Blueprint）的默认模板查找位置？看文档说可以设置 template_folder 参数，然而总报错说找不到模板。

添加仓库的设置页面，导航菜单的选项连接是用 url_for() 函数获取的，然而要写全参数才行：

``` python
url_for('repos.settings', username=repo.owner.username, name=repo.name)
```

要是能像 [Rails](http://rubyonrails.org/) 那样写成 `url_for_repo_settings(repo)` 就好了。或者自己预先定义好这些变量，然后当参数传进模板里？

感觉上面几个功能可以写成一个模块，命名为 `repo_helper.py`，然后代码就可以简化成这样：

``` html
{% raw %}
<a href="{{ url_for_repo }}">Home</a>
<a href="{{ url_for_repo_settings }}">Settings</a>
{% endraw %}
```

``` python
@repo_hepler.route('/settings', methods=['GET'])
def settings(repo):
    return repo_hepler.render('settings/index.html')

@repo_hepler.route('/', methods=['GET'])
def show(repo):
    return repo_hepler.render('show.html')

@repo_hepler.route('/hooks/<string:hookid>', methods=['GET'])
def hooks(repo, hookid):
    return repo_hepler.render('hooks/show.html')
```

自动为模板添加 `repo`、`url_for_repo_settings`、`url_for_repo` 参数，不用再手动传递，方便了很多。

访问 `hello/` 和 `hello` 这两个路径的效果居然不一样，访问 `hello` 时浏览器会自动跳转到 `hello/`，然而 Flask 并未找到与 `hello/` 绑定的函数，返回 404，有什么办法让 Flask 自动重定向，将地址末尾的斜杠去掉？

## 2017-07-23
完成了：

- 用户的 GitHub 管理
- GitHub 代码库导入

修改表结构后，SQLAlchemy 升级失败，报错：

```
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) near "ALTER": syntax error [SQL: u'ALTER TABLE repository ALTER COLUMN name SET NOT NULL']
```

懒得折腾了，直接删库重建。

## 2017-07-22
完成了：

 - 注册
 - 登录
 - 用户资料设置

## 2017-07-19
买入了 gitdigger.com 和 gitdigger.io 两个域名，准备搞个网站，设计文档还在完善中，到时候再贴出来。欢迎各位 Python 大佬提供技术支持。
